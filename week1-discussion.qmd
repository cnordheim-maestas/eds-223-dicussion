---
title: "Week 1: Discussion Section"
format: html
---

Note: helpful: tmap documentation: <https://cran.r-project.org/web/packages/tmap/tmap.pdf>

# 1. Setup

```{r}
library(here)
library(tidyverse)
library(sf)
library(stars)
library(tmap)
library(ggspatial) # for the ggplot below
```

```{r}
ei_points <- st_read(here("week-1", "data", "ei_points.gpkg")) |> 
  filter(type == "volcano")
ei_elev <- read_stars(here("week-1", "data", "ei_elev.tif"))
ei_borders <- st_read(here("week-1", "data", "ei_border.gpkg"))
ei_roads <- st_read(here("week-1", "data", "ei_roads.gpkg"))
```

# 2. Create a single-object map with tmap

Create a map of the outline Rapa Nui using tm_shape() + tm_borders()

```{r}
tm_shape(ei_borders) +
  tm_borders() +
  tm_layout(main.title = "Easter Island")
```

# 3. Create a multiple-object map with tmap

Expand on your single-object map to create a map of Rapa Nui and…

…denote the island’s borders and continuous elevation
…denote the island’s volcanoes and roads
…play with the color palette and essential map elements

```{r}
# already have borders
ei_map <- tm_shape(ei_borders) +
  tm_borders() +
  tm_layout(main.title = "Easter Island") +
  
# add continuous elevation (hint: raster...tm_raster)
tm_shape(ei_elev) +
  tm_raster(col.scale = tm_scale_continuous(values = "-rd_yl_gn"),
            col.legend = tm_legend("Elevation (m asl)")) +
  # let's try a different color 
  # tm_raster(col.scale = tm_scale_continuous(values = "-rd_yl_gn"),
  #           col.legend = tm_legend("Elevation (m asl)")) +
  #  fill.scale = tm_scale(values = c("yellow", "darkgreen")),

# add roads (vector...so tm_lines)
tm_shape(ei_roads) +
  tm_lines() +

# add volcanoes (as points, so tm_symbols)
tm_shape(ei_points) +
  tm_symbols(shape = 24) + # triangle
  tm_add_legend(labels = c("Volcano"),
                col = c("#707070"),
                shape = 24) +

# map elements
tm_compass(position = c("right", "top")) +
  tm_scalebar()

ei_map
```

Or can look at the volcanoes by elevation

```{r}
ei_map <- tm_shape(ei_elev) +
  tm_graticules() +
  tm_raster(col.scale = tm_scale_continuous(values = "-rd_yl_gn"),
            col.legend = tm_legend("Elevation (m asl)")) +
  tm_shape(ei_borders) + 
    tm_borders() +
  tm_shape(ei_roads) +
    tm_lines() +
  tm_shape(ei_points) +
    tm_symbols(shape = 24, 
               size = "elevation", 
               size.legend = tm_legend("Volcanoes (m asl)")) +
  tm_compass(position = c("right", "top")) +
  tm_scalebar() +
  tm_title("Easter Island")

ei_map
```



# 4. Create an interactive map with tmap

```{r}
tmap_mode("view") 
ei_map
```

```{r}
tmap_mode("plot") 
```



5. Create a multiple-object map with ggplot2

```{r}
# extract lat & long from geom column 
volcanoes_point <- ei_points %>%
  mutate(lon = unlist(map(ei_points$geom,1)), # longitude = first component (x)
         lat = unlist(map(ei_points$geom,2))) # latitude = second component (y)

ggplot() +
  # first add Easter Isand borders
  geom_sf(data = ei_borders, color = "#212529") +
  # add elevation raster
  geom_stars(data = ei_elev) +
  scale_fill_distiller(name = "Elevation (m asl)", # legend title with units
                       palette = "RdYlGn",         # red-yellow-green palette (no need to reverse)
                       na.value = "lightblue") +  # set NA color (background ocean)
  # add road vector
  geom_sf(data = ei_roads, color = "#343a40") +
  # add volcano vector
  geom_point(data = volcanoes_point, 
             aes(x = lon, y = lat, 
                 size = elevation), # point size depends on attribute value
             shape = 17,            # triangle
             color = "#22577a") +
  scale_size_continuous(name = "Volcanoes (m asl)") +       # legend title with units
  ggspatial::annotation_north_arrow(location = "br",        # bottom right
                                    which_north = "true") + # point to north pole
  ggspatial::annotation_scale(location = "bl",              # bottom left
                              width_hint = 0.5) +           # proportion of map area the scalebar should occupy
  labs(title = "Easter Island") +
  theme_minimal()
```


